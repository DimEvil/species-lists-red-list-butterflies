---
title: "Read data"
subtitle: "For: National checklists and red lists for prioritising European butterfly conservation actions"
author:
- Lien Reyserhove
- Peter Desmet
- Dimitri Brosens
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_depth: 3
    toc_float: true
    number_sections: true
---

This document describes how we import the "National checklists and red lists for prioritising European butterfly conservations actions" dataset from the basic [Googlesheets document](https://docs.google.com/spreadsheets/d/1RvxpOYf2ZrTu9nsTLumoi-G-GGhh6_lV37TNtPiVES4/edit?ts=5b1f937f#gid=0) as four separate [csv files](https://github.com/inbo/red-lists-european-butterflies-checklist/tree/master/data/interim) on GitHub. It further describes how we add species phylogeny information to the taxon files by using the GBIF backbone.

# Setup

```{r setup, echo = FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

Set locale (so we use UTF-8 character encoding):

```{r}
# This works on Mac OS X, might not work on other OS
Sys.setlocale("LC_CTYPE", "en_US.UTF-8")
```

Load libraries:

```{r}
library(tidyverse)       # To transform data
library(magrittr)        # For %<>% pipes
library(googlesheets)    # To import and read Google spreadsheets 
library(inborutils)      # To match species names with GBIF backbone
```

Set file paths (all paths should be relative to this script):
 
```{r}
taxa_europe_file = "../data/interim/taxa_europe.csv"
taxa_regional_file = "../data/interim/taxa_regional.csv"
regional_threat_scores_file = "../data/interim/regional_threat_scores.csv"
references_file = "../data/interim/references.csv"
```

## Read raw data

The original spreadsheet can be found [here](https://docs.google.com/spreadsheets/d/1RvxpOYf2ZrTu9nsTLumoi-G-GGhh6_lV37TNtPiVES4/edit?ts=5b1f937f#gid=1323544344). We need to retrieve this spreadsheet and select the specific Googlesheet:

```{r}
retrieve_spreadsheet <- gs_title("EuroButt")
```

This spreadsheet contains four different worksheets: `taxa_europe`, `taxa_regional`, `regional_threat_scores` and `references`. We select these here and save them as separate data frames. We will first continue with the `taxa_regional` as this the original dataframe.

```{r}
# taxa_europe <- retrieve_spreadsheet %>% gs_read("taxa_europe") 
taxa_regional <- retrieve_spreadsheet %>% gs_read("taxa_regional") 
regional_threat_scores <- retrieve_spreadsheet %>% gs_read("regional_threat_scores")
references <- retrieve_spreadsheet %>% gs_read("references")
```

## Export files to interim folder

We add a copy of the four generated data frames to the [interim folder](https://github.com/inbo/red-lists-european-butterflies-checklist/tree/master/data/interim) on Github:

```{r}
#write.csv(taxa_europe, file = taxa_europe_file, na = "", row.names = FALSE, fileEncoding = "UTF-8")
write.csv(taxa_regional, file = taxa_regional_file, na = "", row.names = FALSE, fileEncoding = "UTF-8")
write.csv(regional_threat_scores, file = regional_threat_scores_file, na = "", row.names = FALSE, fileEncoding = "UTF-8")
write.csv(references, file = references_file, na = "", row.names = FALSE, fileEncoding = "UTF-8")
```